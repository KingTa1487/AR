<!DOCTYPE html>
<html>
<head>
<style>
	#info{
		position: absolute;
		top: 0px;
		width: 100%;
		padding: 10px;
		text-align:center;
		color: #ffffff;
	}
	body{
		overflow: hidden;
	}
</style>
</head>

<body>
<div id="info">touch bubble<br><br>
	<button id="hit">hit</button>
</div>

<script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
<script src="https://threejs.org/build/three.min.js"></script>
<script src="https://threejs.org/examples/js/controls/OrbitControls.js"></script>

<script src="TempoBubble.js"></script> 
<script src="Boxs.js"></script>
<script>

var renderer, scene, camera; 
var scale = 0, angle = 0;
var boom = false;
var box, bubble;

init();
animate();

$("#hit").click(function(){
	boom = true;
});

function init () {
	
	renderer = new THREE.WebGLRenderer();
	document.body.appendChild (renderer.domElement);
	var width = window.innerWidth;
	var height = window.innerHeight;
	renderer.setSize (width, height);
	
	renderer.setClearColor (0x888888);
	
	scene = new THREE.Scene();
	var grid = new THREE.GridHelper(200,40, 0xaaaa00, 0x333333);
	scene.add (grid);
	var axes = new THREE.AxesHelper (5);
	scene.add (axes);
	
	camera = new THREE.PerspectiveCamera (50, width/height, 1, 1000);
	camera.position.y = 150;
	camera.position.z = 250;
	camera.lookAt (new THREE.Vector3(0,0,0));
	
	let controls = new THREE.OrbitControls(camera, renderer.domElement);
	
	window.addEventListener('resize', onWindowResize, false);
	///////////////////////////////////////////////////////////////
	
	bubble = new TempoBubble();
	box = new Boxs(bubble.bubble);
	box.Box.visible = false;
	
	var light = new THREE.PointLight(0xffffff);
	light.position.y = 100;
	
	scene.add(light);
		
}

function onWindowResize() {
  
  var width = window.innerWidth;
  var height = window.innerHeight;
  camera.aspect = width / height;
  camera.updateProjectionMatrix();
  renderer.setSize(width, height);
	
}

function animate() {
	angle += 0.02;
	
	bubble.bubble.rotation.x = angle;
	bubble.bubble.rotation.y = angle;
	
	
	if(bubble.bubble.scale.x < 2.7){
		scale += 0.03;
		bubble.bubble.scale.set(scale, scale, scale);
		
		if(bubble.bubble.scale.x > 2)
			bubble.bubble.material.color.setHSL(0, 1, 0.5);
	}
	if(boom == true){
		scale -= 0.1;
		box.Box.visible = true;
		bubble.bubble.visible = false;
		explode(angle*5, bubble.bubble.scale.x, box.Box);
	}

	
	requestAnimationFrame(animate);
	render();
	
}

function render() {
	
	renderer.render(scene, camera);
	
}

</script>
</body>

</html>

